// src/config/environment.js
import { detectHostingType, getHostingConfig } from './hosting-detector';

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –±–µ–∑–ø–µ—á–Ω–æ–≥–æ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è environment –∑–º—ñ–Ω–Ω–∏—Ö
const getEnvVar = (name, fallback = null) => {
  try {
    if (typeof process !== 'undefined' && process.env && process.env[name]) {
      return process.env[name];
    }
    
    if (typeof window !== 'undefined' && window.process && window.process.env && window.process.env[name]) {
      return window.process.env[name];
    }
    
    return fallback;
  } catch (error) {
    console.warn(`–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –∑–º—ñ–Ω–Ω—É ${name}:`, error);
    return fallback;
  }
};

// –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è runtime –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
const getRuntimeConfig = () => {
  try {
    // üÜï –î–û–î–ê–ù–û: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ universal config –ø–µ—Ä—à–∏–º
    if (typeof window !== 'undefined' && window.COMSPEC_UNIVERSAL && window.COMSPEC_UNIVERSAL.ready) {
      console.log('üåê –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ UNIVERSAL CONFIG');
      return window.COMSPEC_UNIVERSAL.config;
    }
    
    if (typeof window !== 'undefined' && window.RUNTIME_CONFIG) {
      console.log('üì¶ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ RUNTIME_CONFIG');
      return window.RUNTIME_CONFIG;
    }
    
    if (typeof window !== 'undefined' && window.COMSPEC_CONFIG) {
      console.log('üì¶ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ COMSPEC runtime –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é');
      return window.COMSPEC_CONFIG;
    }
    
    if (typeof window !== 'undefined' && window.APP_CONFIG) {
      console.log('üì¶ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ APP runtime –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é');
      return window.APP_CONFIG;
    }
    
    return null;
  } catch (error) {
    console.warn('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è runtime –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó:', error);
    return null;
  }
};

// üÜï –î–û–î–ê–ù–û: –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó universal config —É —Ñ–æ—Ä–º–∞—Ç —è–∫–∏–π –æ—á—ñ–∫—É—é—Ç—å —ñ—Å–Ω—É—é—á—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏
const convertUniversalConfig = (universalConfig) => {
  if (!universalConfig) return null;
  
  console.log('üîÑ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è universal config –≤ —ñ—Å–Ω—É—é—á–∏–π —Ñ–æ—Ä–º–∞—Ç...');
  
  return {
    // –Ü—Å–Ω—É—é—á—ñ –Ω–∞–∑–≤–∏ –≤ –≤–∞—à—ñ–π —Å–∏—Å—Ç–µ–º—ñ
    MAPS_API_KEY: universalConfig.GOOGLE_MAPS?.API_KEY,
    SCRIPT_URL: universalConfig.GOOGLE_SHEETS?.SCRIPT_URL,
    SHEETS_ID: universalConfig.GOOGLE_SHEETS?.SPREADSHEET_ID,
    SHEETS_API_KEY: universalConfig.GOOGLE_SHEETS?.API_KEY,
    
    // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –Ω–∞–∑–≤–∏ –¥–ª—è —ñ—Å–Ω—É—é—á–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤
    GOOGLE_MAPS_API_KEY: universalConfig.GOOGLE_MAPS?.API_KEY,
    GOOGLE_SCRIPT_URL: universalConfig.GOOGLE_SHEETS?.SCRIPT_URL,
    GOOGLE_SHEETS_ID: universalConfig.GOOGLE_SHEETS?.SPREADSHEET_ID,
    GOOGLE_SHEETS_API_KEY: universalConfig.GOOGLE_SHEETS?.API_KEY,
    
    // –î–æ–¥–∞—Ç–∫–æ–≤—ñ –ø–æ–ª—è –∑ universal config
    DEBUG_MODE: universalConfig.DEBUG || false,
    ENVIRONMENT: universalConfig.ENVIRONMENT || 'unknown',
    META: universalConfig.META || {}
  };
};

// –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Ö–æ—Å—Ç–∏–Ω–≥—ñ–≤ (–ó–ë–ï–†–ï–ñ–ï–ù–û –í–ê–® –ö–û–î)
const configs = {
  development: {
    // ‚úÖ –ü–Ü–î–õ–ê–®–¢–û–í–ê–ù–û –ø—ñ–¥ —ñ—Å–Ω—É—é—á—ñ –∑–º—ñ–Ω–Ω—ñ –≤ .env.local
    MAPS_API_KEY: getEnvVar('REACT_APP_GOOGLE_MAPS_API_KEY', 'AIzaSyBge_xIIrIbmc9Y7hPG5Fqkgkd5H4y5EUI'),
    SCRIPT_URL: getEnvVar('REACT_APP_GOOGLE_SCRIPT_URL', 'https://script.google.com/macros/s/AKfycbxpeWfinzQLOkuKFKlwjLt-cb9c8TTXt4WGq9tFrtYkaZ4Xc5H68-NND-AwTsW9DDDp/exec'),
    SHEETS_ID: getEnvVar('REACT_APP_GOOGLE_SHEETS_ID', '1xJzmIKJ8vv7IY8Or5eiRmXbsfVbQL8ejZNqXP9OnTDY'),
    SHEETS_API_KEY: getEnvVar('REACT_APP_GOOGLE_SHEETS_API_KEY', 'AIzaSyC9sM0GgS6XdzV2H5hqNXahzZ34Jfo58mU'),
    
    // üÜï TELEGRAM –ö–û–ù–§–Ü–ì–£–†–ê–¶–Ü–Ø
    TELEGRAM_BOT_TOKEN: getEnvVar('REACT_APP_TELEGRAM_BOT_TOKEN', '8472229536:AAEquKfaV_nIa5opQAbb6Io2RSm3HRRFgO4'),
    TELEGRAM_CHAT_ID: getEnvVar('REACT_APP_TELEGRAM_CHAT_ID', null),
    TELEGRAM_ENABLED: getEnvVar('REACT_APP_TELEGRAM_ENABLED', 'true') === 'true',
    TELEGRAM_API_URL: 'https://api.telegram.org/bot',
    TELEGRAM_TIMEOUT: 10000,
    
    // üÜï –ú–ê–ü–Ü–ù–ì –ú–ï–ù–ï–î–ñ–ï–†–Ü–í (–¢–ò–ú–ß–ê–°–û–í–ò–ô - –±—É–¥–µ –∑–∞–º—ñ–Ω–µ–Ω–æ –Ω–∞ Google Sheets)
    TELEGRAM_MANAGERS: {
      "–Ü–≥–æ—Ä –ö–∞–ª—ñ–Ω–∫—ñ–Ω": null,
      "–û–ª–µ–∫—Å–∞–Ω–¥—Ä–∞ –ú–æ—Ä–æ–∂–∏–∫": null,
      "–í—ñ–∫—Ç–æ—Ä—ñ—è –õ—ñ–Ω–∫–µ–≤–∏—á": null,
      "–Ü—Ä–∏–Ω–∞ –Ñ—Ä–º–∞–∫": null,
      "–ê–Ω–Ω–∞ –ì—É—Ä—Å—å–∫–∞": null,
      "–¢–µ—Ç—è–Ω–∞ –ì–æ—Ä–æ–±—ñ–≤—Å—å–∫–∞": null,
      "–í–æ–ª–æ–¥–∏–º–∏—Ä –ú–∞–∫—Å–∏–º—É–∫": null,
      "–ì–µ–Ω–Ω–∞–¥—ñ–π –î–∏–∫–∏–π": "1559533342"
    },
    
    // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –Ω–∞–∑–≤–∏ –¥–ª—è —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ –∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
    GOOGLE_MAPS_API_KEY: getEnvVar('REACT_APP_GOOGLE_MAPS_API_KEY', 'AIzaSyBge_xIIrIbmc9Y7hPG5Fqkgkd5H4y5EUI'),
    GOOGLE_SCRIPT_URL: getEnvVar('REACT_APP_GOOGLE_SCRIPT_URL', 'https://script.google.com/macros/s/AKfycbxpeWfinzQLOkuKFKlwjLt-cb9c8TTXt4WGq9tFrtYkaZ4Xc5H68-NND-AwTsW9DDDp/exec'),
    GOOGLE_SHEETS_ID: getEnvVar('REACT_APP_GOOGLE_SHEETS_ID', '1xJzmIKJ8vv7IY8Or5eiRmXbsfVbQL8ejZNqXP9OnTDY'),
    GOOGLE_SHEETS_API_KEY: getEnvVar('REACT_APP_GOOGLE_SHEETS_API_KEY', 'AIzaSyC9sM0GgS6XdzV2H5hqNXahzZ34Jfo58mU')
  },
  
  github: {
    // ‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Ç—ñ —Å–∞–º—ñ –Ω–∞–∑–≤–∏ —â–æ —ñ –≤ .env.local
    MAPS_API_KEY: 'AIzaSyBge_xIIrIbmc9Y7hPG5Fqkgkd5H4y5EUI',
    SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbz3XE8u5O2Q9ez4OpKcyPB6TtrGp0ul6hPJsud4Dethj0fA2ixU7t4XCwJefl4EIgAd/exec',
    SHEETS_ID: '1xJzmIKJ8vv7IY8Or5eiRmXbsfVbQL8ejZNqXP9OnTDY',
    SHEETS_API_KEY: 'AIzaSyC9sM0GgS6XdzV2H5hqNXahzZ34Jfo58mU',
    
    // üÜï TELEGRAM –ö–û–ù–§–Ü–ì–£–†–ê–¶–Ü–Ø –î–õ–Ø GITHUB PAGES
    TELEGRAM_BOT_TOKEN: '8472229536:AAEquKfaV_nIa5opQAbb6Io2RSm3HRRFgO4',
    TELEGRAM_CHAT_ID: null,
    TELEGRAM_ENABLED: true,
    TELEGRAM_API_URL: 'https://api.telegram.org/bot',
    TELEGRAM_TIMEOUT: 10000,
    
    // üÜï –ú–ê–ü–Ü–ù–ì –ú–ï–ù–ï–î–ñ–ï–†–Ü–í (GITHUB PAGES)
    TELEGRAM_MANAGERS: {
      "–Ü–≥–æ—Ä –ö–∞–ª—ñ–Ω–∫—ñ–Ω": null,
      "–û–ª–µ–∫—Å–∞–Ω–¥—Ä–∞ –ú–æ—Ä–æ–∂–∏–∫": null,
      "–í—ñ–∫—Ç–æ—Ä—ñ—è –õ—ñ–Ω–∫–µ–≤–∏—á": null,
      "–Ü—Ä–∏–Ω–∞ –Ñ—Ä–º–∞–∫": null,
      "–ê–Ω–Ω–∞ –ì—É—Ä—Å—å–∫–∞": null,
      "–¢–µ—Ç—è–Ω–∞ –ì–æ—Ä–æ–±—ñ–≤—Å—å–∫–∞": null,
      "–í–æ–ª–æ–¥–∏–º–∏—Ä –ú–∞–∫—Å–∏–º—É–∫": null,
      "–ì–µ–Ω–Ω–∞–¥—ñ–π –î–∏–∫–∏–π": "1559533342"
    },
    
    // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –Ω–∞–∑–≤–∏ –¥–ª—è —ñ—Å–Ω—É—é—á–∏—Ö —Ñ–∞–π–ª—ñ–≤
    GOOGLE_MAPS_API_KEY: 'AIzaSyBge_xIIrIbmc9Y7hPG5Fqkgkd5H4y5EUI',
    GOOGLE_SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbz3XE8u5O2Q9ez4OpKcyPB6TtrGp0ul6hPJsud4Dethj0fA2ixU7t4XCwJefl4EIgAd/exec',
    GOOGLE_SHEETS_ID: '1xJzmIKJ8vv7IY8Or5eiRmXbsfVbQL8ejZNqXP9OnTDY',
    GOOGLE_SHEETS_API_KEY: 'AIzaSyC9sM0GgS6XdzV2H5hqNXahzZ34Jfo58mU'
  },
  
  shared: {
    MAPS_API_KEY: null,
    SCRIPT_URL: null,
    SHEETS_ID: null,
    SHEETS_API_KEY: null,
    TELEGRAM_BOT_TOKEN: null,
    TELEGRAM_CHAT_ID: null,
    TELEGRAM_ENABLED: false,
    TELEGRAM_API_URL: 'https://api.telegram.org/bot',
    TELEGRAM_TIMEOUT: 10000,
    GOOGLE_MAPS_API_KEY: null,
    GOOGLE_SCRIPT_URL: null,
    GOOGLE_SHEETS_ID: null,
    GOOGLE_SHEETS_API_KEY: null
  },
  
  vps: {
    MAPS_API_KEY: null,
    SCRIPT_URL: null,
    SHEETS_ID: null,
    SHEETS_API_KEY: null,
    TELEGRAM_BOT_TOKEN: null,
    TELEGRAM_CHAT_ID: null,
    TELEGRAM_ENABLED: false,
    TELEGRAM_API_URL: 'https://api.telegram.org/bot',
    TELEGRAM_TIMEOUT: 10000,
    GOOGLE_MAPS_API_KEY: null,
    GOOGLE_SCRIPT_URL: null,
    GOOGLE_SHEETS_ID: null,
    GOOGLE_SHEETS_API_KEY: null
  }
};

// –ì–æ–ª–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó (–ú–û–î–ò–§–Ü–ö–û–í–ê–ù–ê)
const getConfig = () => {
  // üÜï –î–û–î–ê–ù–û: –°–ø–æ—á–∞—Ç–∫—É –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ universal config
  const runtimeConfig = getRuntimeConfig();
  if (runtimeConfig && typeof window !== 'undefined' && window.COMSPEC_UNIVERSAL) {
    const convertedConfig = convertUniversalConfig(runtimeConfig);
    if (convertedConfig) {
      console.log('‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ –∫–æ–Ω–≤–µ—Ä—Ç–æ–≤–∞–Ω–∏–π universal config');
      
      // –î–æ–¥–∞—î–º–æ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –ø–æ–ª—è —è–∫—ñ –æ—á—ñ–∫—É—î –≤–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞
      convertedConfig.ENVIRONMENT = window.COMSPEC_UNIVERSAL.hosting?.type || 'universal';
      convertedConfig.DEBUG_MODE = convertedConfig.DEBUG_MODE || (window.COMSPEC_UNIVERSAL.hosting?.type === 'development');
      convertedConfig.HOSTING_INFO = window.COMSPEC_UNIVERSAL.hosting || {};
      
      return convertedConfig;
    }
  }
  
  // üîÑ –ó–ë–ï–†–ï–ñ–ï–ù–û: –í–∞—à–∞ —ñ—Å–Ω—É—é—á–∞ –ª–æ–≥—ñ–∫–∞ —è–∫ fallback
  const hostingType = detectHostingType();
  const hostingConfig = getHostingConfig();
  
  console.log(`üåê –í–∏—è–≤–ª–µ–Ω–æ —Ç–∏–ø —Ö–æ—Å—Ç–∏–Ω–≥—É: ${hostingType}`);
  
  let config = {};
  
  switch (hostingType) {
    case 'development':
      config = configs.development;
      console.log('üîß –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ development –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é');
      break;
      
    case 'vps':
    case 'dedicated':
      config = {
        MAPS_API_KEY: getEnvVar('REACT_APP_GOOGLE_MAPS_API_KEY'),
        SCRIPT_URL: getEnvVar('REACT_APP_GOOGLE_SCRIPT_URL'),
        SHEETS_ID: getEnvVar('REACT_APP_GOOGLE_SHEETS_ID'),
        SHEETS_API_KEY: getEnvVar('REACT_APP_GOOGLE_SHEETS_API_KEY'),
        // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –Ω–∞–∑–≤–∏
        GOOGLE_MAPS_API_KEY: getEnvVar('REACT_APP_GOOGLE_MAPS_API_KEY'),
        GOOGLE_SCRIPT_URL: getEnvVar('REACT_APP_GOOGLE_SCRIPT_URL'),
        GOOGLE_SHEETS_ID: getEnvVar('REACT_APP_GOOGLE_SHEETS_ID'),
        GOOGLE_SHEETS_API_KEY: getEnvVar('REACT_APP_GOOGLE_SHEETS_API_KEY')
      };
      
      const fallbackRuntimeConfig = getRuntimeConfig();
      if (fallbackRuntimeConfig && !config.MAPS_API_KEY) {
        config = { ...config, ...fallbackRuntimeConfig };
        console.log('üîÑ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ runtime –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é —è–∫ fallback');
      }
      
      if (!config.MAPS_API_KEY) {
        config = { ...config, ...configs.github };
        console.log('‚ö†Ô∏è –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ hardcoded –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é —è–∫ fallback');
      }
      break;
      
    case 'shared':
      const runtime = getRuntimeConfig();
      if (runtime) {
        config = runtime;
        console.log('‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ runtime –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é');
      } else {
        config = configs.github;
        console.log('‚ö†Ô∏è Runtime –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ hardcoded');
      }
      break;
      
    case 'github':
    default:
      config = configs.github;
      console.log('üìÑ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ GitHub Pages –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é');
      break;
  }
  
  config.ENVIRONMENT = hostingType;
  config.DEBUG_MODE = hostingType === 'development' || getEnvVar('REACT_APP_DEBUG_MODE') === 'true';
  config.HOSTING_INFO = hostingConfig;
  
  return config;
};

// –í–∞–ª—ñ–¥–∞—Ü—ñ—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó (–ó–ë–ï–†–ï–ñ–ï–ù–û –í–ê–® –ö–û–î)
export const validateConfig = (config) => {
  const required = ['GOOGLE_SCRIPT_URL', 'GOOGLE_MAPS_API_KEY'];
  const missing = required.filter(key => !config[key]);
  
  if (missing.length > 0) {
    console.error('‚ùå –í—ñ–¥—Å—É—Ç–Ω—ñ –æ–±–æ–≤\'—è–∑–∫–æ–≤—ñ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω—ñ –∑–º—ñ–Ω–Ω—ñ:', missing);
    return false;
  }
  
  console.log('‚úÖ –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è –≤–∞–ª—ñ–¥–Ω–∞');
  return true;
};

// –ë–µ–∑–ø–µ—á–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è (–ó–ë–ï–†–ï–ñ–ï–ù–û –í–ê–® –ö–û–î)
export const logConfig = (config) => {
  const safeConfig = Object.entries(config).reduce((acc, [key, value]) => {
    if (key.includes('KEY') || key.includes('URL')) {
      acc[key] = value ? `${value.substring(0, 10)}...` : '–í–Ü–î–°–£–¢–ù–Ü–ô';
    } else {
      acc[key] = value;
    }
    return acc;
  }, {});
  
  console.log('üìã –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è COMSPEC:', safeConfig);
  return safeConfig;
};

// ‚úÖ –ó–ë–ï–†–ï–ñ–ï–ù–û: –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ –∑ —ñ—Å–Ω—É—é—á–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
export const getEnvironmentConfig = () => {
  return getConfig();
};

// üÜï –î–û–î–ê–ù–û: –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —á–µ–∫–∞–Ω–Ω—è universal config
export const waitForUniversalConfig = (timeout = 3000) => {
  return new Promise((resolve) => {
    // –Ø–∫—â–æ –≤–∂–µ –≥–æ—Ç–æ–≤–æ
    if (window.COMSPEC_UNIVERSAL?.ready) {
      resolve(getConfig());
      return;
    }
    
    // –°–ª—É—Ö–∞—î–º–æ –ø–æ–¥—ñ—é –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—ñ
    const handleConfigReady = () => {
      cleanup();
      resolve(getConfig());
    };
    
    // Timeout
    const timeoutId = setTimeout(() => {
      cleanup();
      console.log('‚è∞ Timeout –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è universal config, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ fallback');
      resolve(getConfig());
    }, timeout);
    
    // Cleanup
    const cleanup = () => {
      window.removeEventListener('comspec-config-ready', handleConfigReady);
      clearTimeout(timeoutId);
    };
    
    // –°–ª—É—Ö–∞—á –ø–æ–¥—ñ—ó
    window.addEventListener('comspec-config-ready', handleConfigReady);
  });
};

// –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
const config = getConfig();

// –í–∞–ª—ñ–¥–∞—Ü—ñ—è –ø—Ä–∏ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó
if (!validateConfig(config)) {
  console.error('üö® –ö—Ä–∏—Ç–∏—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó. –î–µ—è–∫—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –º–æ–∂—É—Ç—å –Ω–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏.');
}

// –õ–æ–≥—É–≤–∞–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó (—Ç—ñ–ª—å–∫–∏ –≤ development)
if (config.DEBUG_MODE) {
  logConfig(config);
}

// –ì–ª–æ–±–∞–ª—å–Ω–∏–π –¥–æ—Å—Ç—É–ø –¥–ª—è –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è (–†–û–ó–®–ò–†–ï–ù–û)
if (typeof window !== 'undefined') {
  window.COMSPEC_DEBUG = {
    config: config,
    logConfig: () => logConfig(config),
    validateConfig: () => validateConfig(config),
    detectHostingType,
    getHostingConfig,
    getConfig,
    getEnvironmentConfig,
    // üÜï –î–û–î–ê–ù–û: –ù–æ–≤—ñ debug —Ñ—É–Ω–∫—Ü—ñ—ó
    waitForUniversalConfig,
    convertUniversalConfig,
    hasUniversalConfig: () => !!(window.COMSPEC_UNIVERSAL?.ready),
    getUniversalConfig: () => window.COMSPEC_UNIVERSAL
  };
}

export default config;
export { getConfig };